#!/bin/sh
set -e

# Source debconf library.
. /usr/share/debconf/confmodule

db_get flocker-buildslave/slavename
if [ ! -e /srv/flocker-buildslave/slave/slave.name ]; then
    echo $RET > /srv/flocker-buildslave/slave/slave.name
fi
db_get flocker-buildslave/password
if [ ! -e /srv/flocker-buildslave/slave/slave.passwd ]; then
    echo $RET > /srv/flocker-buildslave/slave/slave.passwd
fi

if ! getent passwd flocker-buildslave>/dev/null; then
    adduser --quiet \
        --system \
        --disabled-login \
        --disabled-password \
        --no-create-home \
        --group \
        --gecos "Flocker Buildslave" \
        --home /srv/flocker-buildslave \
        flocker-buildslave
    chown flocker-buildslave:flocker-buildslave /srv/flocker-buildslave /srv/flocker-buildslave/slave
fi

#DEBHLPER#
